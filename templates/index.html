{% extends "base.html" %}

{% block title %}
Home ‚Ä¢ DevOps Notes Manager
{% endblock %}

{% block content %}

<!-- ================= DASHBOARD HEADER ================= -->
<div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
    <div>
        <h1 class="text-3xl font-bold text-white tracking-tight">Dashboard</h1>
        <p class="text-zinc-400 mt-1">Overview of your DevOps snippets and configurations.</p>
    </div>
    <!-- Quick Action / potentially redundant if form is inline, but keeping for mobile -->
    <a href="#add-note-card" class="md:hidden inline-flex items-center px-4 py-2 bg-accent-600 hover:bg-accent-700 text-white text-sm font-medium rounded-lg transition-colors shadow-lg shadow-accent-900/20">
        <span>Ôºã New Note</span>
    </a>
</div>

<!-- ================= STATS ROW ================= -->
<section class="dashboard-stats mb-10">
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- Stat Card 1 -->
    <div class="bg-zinc-900/50 backdrop-blur border border-zinc-800 rounded-xl p-5 shadow-sm group hover:border-zinc-700 hover:ring-1 hover:ring-zinc-800 transition-all duration-300">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-lg bg-blue-500/10 text-blue-400 border border-blue-500/20 flex items-center justify-center text-xl group-hover:scale-110 transition-transform duration-300 shadow-inner">üìö</div>
        <div>
          <h3 class="text-2xl font-bold text-white font-mono">{{ total_notes }}</h3>
          <p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Total Notes</p>
        </div>
      </div>
    </div>

    <!-- Stat Card 2 -->
    <div class="bg-zinc-900/50 backdrop-blur border border-zinc-800 rounded-xl p-5 shadow-sm group hover:border-zinc-700 hover:ring-1 hover:ring-zinc-800 transition-all duration-300">
      <div class="flex items-center gap-4">
         <div class="w-12 h-12 rounded-lg bg-green-500/10 text-green-400 border border-green-500/20 flex items-center justify-center text-xl group-hover:scale-110 transition-transform duration-300 shadow-inner">üìä</div>
        <div>
          <h3 class="text-2xl font-bold text-white font-mono">{{ category_counts|length }}</h3>
          <p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Categories</p>
        </div>
      </div>
    </div>

    <!-- Stat Card 3 -->
    <div class="bg-zinc-900/50 backdrop-blur border border-zinc-800 rounded-xl p-5 shadow-sm group hover:border-zinc-700 hover:ring-1 hover:ring-zinc-800 transition-all duration-300">
      <div class="flex items-center gap-4">
         <div class="w-12 h-12 rounded-lg bg-yellow-500/10 text-yellow-400 border border-yellow-500/20 flex items-center justify-center text-xl group-hover:scale-110 transition-transform duration-300 shadow-inner">üè∑Ô∏è</div>
        <div>
          <h3 class="text-2xl font-bold text-white font-mono">{{ popular_tags|length }}</h3>
          <p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Tags</p>
        </div>
      </div>
    </div>
    
    <!-- Stat Card 4 -->
    <div class="bg-zinc-900/50 backdrop-blur border border-zinc-800 rounded-xl p-5 shadow-sm group hover:border-zinc-700 hover:ring-1 hover:ring-zinc-800 transition-all duration-300">
      <div class="flex items-center gap-4">
         <div class="w-12 h-12 rounded-lg bg-purple-500/10 text-purple-400 border border-purple-500/20 flex items-center justify-center text-xl group-hover:scale-110 transition-transform duration-300 shadow-inner">‚≠ê</div>
        <div>
          <h3 class="text-2xl font-bold text-white font-mono">{{ recent_notes|length }}</h3>
          <p class="text-xs font-medium text-zinc-500 uppercase tracking-wider">Recent</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ================= STANDARD INPUT (ADD NOTE) ================= -->
<section class="mb-12" id="add-note-card">
    <div class="bg-zinc-900/50 rounded-xl border border-zinc-800 shadow-sm overflow-hidden ring-1 ring-white/5">
       <!-- Card Header -->
       <div class="px-6 py-4 border-b border-zinc-800 flex items-center justify-between bg-zinc-900/80 backdrop-blur-sm">
            <h3 class="text-sm font-semibold text-white uppercase tracking-wider flex items-center gap-2">
                <span class="text-red-500 animate-pulse">Ôºã</span> Create New Snippet
            </h3>
       </div>

       <form method="POST" class="note-form p-6 space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Command Input -->
                <div class="space-y-2">
                    <label class="block text-xs font-medium text-zinc-400 uppercase tracking-wide ml-1">Command / Title</label>
                    <input name="command" placeholder="e.g. Docker Compose Up" required class="w-full h-11 px-4 rounded-lg bg-zinc-950/80 border border-zinc-800 text-zinc-200 text-sm placeholder:text-zinc-600 focus:outline-none focus:border-red-500/50 focus:ring-1 focus:ring-red-500/50 transition-all shadow-inner" />
                </div>
                
                <!-- Category Select -->
                <div class="space-y-2">
                    <label class="block text-xs font-medium text-zinc-400 uppercase tracking-wide ml-1">Category</label>
                    <select name="category" class="w-full h-11 px-4 rounded-lg bg-zinc-950/80 border border-zinc-800 text-zinc-300 text-sm focus:outline-none focus:border-red-500/50 focus:ring-1 focus:ring-red-500/50 transition-all shadow-inner">
                      <option value="">Select Category...</option>
                      {% for cat in categories %}
                        <option value="{{ cat.name|lower }}">{{ cat.name }}</option>
                      {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Description Editor -->
            <div class="space-y-2">
                <label class="block text-xs font-medium text-zinc-400 uppercase tracking-wide ml-1">Description & Notes</label>
                <div id="description-editor" class="bg-zinc-950/80 rounded-lg border border-zinc-800 min-h-[120px] text-zinc-300 prose-invert shadow-inner focus-within:border-red-500/50 focus-within:ring-1 focus-within:ring-red-500/50 transition-all"></div>
                <input type="hidden" name="description" id="description-input" required />
            </div>
            
            <!-- Footer Actions -->
            <div class="flex flex-col sm:flex-row gap-4 items-end pt-2">
                <div class="flex-1 w-full space-y-2">
                    <label class="block text-xs font-medium text-zinc-400 uppercase tracking-wide ml-1">Tags (Comma separated)</label>
                    <input name="tags" placeholder="network, db, production" class="w-full h-11 px-4 rounded-lg bg-zinc-950/80 border border-zinc-800 text-zinc-300 text-sm placeholder:text-zinc-600 focus:outline-none focus:border-red-500/50 focus:ring-1 focus:ring-red-500/50 transition-all shadow-inner" />
                </div>
                <button type="submit" class="w-full sm:w-auto px-6 h-11 bg-red-600 hover:bg-red-500 text-white text-sm font-semibold rounded-lg transition-all shadow-lg shadow-red-900/20 border border-transparent hover:border-red-400 hover:shadow-red-900/30 flex items-center justify-center gap-2">
                    <span>Save Snippet</span>
                </button>
            </div>
       </form>
    </div>
</section>

<!-- ================= NOTES ================= -->
<section class="features" id="notes-section">
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
    <div class="flex items-center gap-3">
      <h2 class="text-xl font-bold text-white flex items-center gap-2">
        <span class="text-accent-500">~/</span> Notes
      </h2>
      <div class="px-2 py-0.5 rounded-full bg-zinc-800/50 border border-zinc-700/50 text-xs font-mono text-zinc-400">{{ notes|length }} items</div>
    </div>
    
    <div class="flex items-center gap-3">
      <select id="sortSelect" class="sort-select h-9 px-3 rounded bg-zinc-900 border border-zinc-800 text-sm text-zinc-300 focus:outline-none focus:ring-1 focus:ring-accent-500/50">
        <option value="newest">Newest First</option>
        <option value="oldest">Oldest First</option>
        <option value="category">By Category</option>
        <option value="alphabetical">Alphabetical</option>
      </select>

      <div class="view-toggle flex items-center bg-zinc-900 rounded p-1 border border-zinc-800">
        <button class="view-btn active p-1.5 rounded hover:bg-zinc-800 text-zinc-500 hover:text-zinc-300 [&.active]:bg-zinc-700 [&.active]:text-accent-400 transition-all" data-view="grid">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
        </button>
        <button class="view-btn p-1.5 rounded hover:bg-zinc-800 text-zinc-500 hover:text-zinc-300 [&.active]:bg-zinc-700 [&.active]:text-accent-400 transition-all" data-view="list">
             <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
        </button>
      </div>
    </div>
  </div>

  {% if notes %}
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6" id="notesGrid">
    {% for note in notes %}
    <div class="feature-card bg-zinc-900 border border-zinc-800 rounded-lg flex flex-col shadow-sm hover:border-zinc-700 hover:shadow-lg transition-all duration-300 group relative overflow-hidden ring-1 ring-white/0 hover:ring-white/5" data-category="{{ note.category|lower|default('other') }}">
        <!-- Subtle Top Highlight -->
        <div class="absolute inset-x-0 top-0 h-1 bg-gradient-to-r from-red-500/0 via-red-500/40 to-red-500/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        
        <div class="relative flex flex-col h-full p-5">

          <div class="flex items-start justify-between mb-3">
              <h3 class="text-sm font-semibold text-zinc-100 truncate pr-2 tracking-tight">{{ note.command }}</h3>
              {% if note.category %}
                <span class="text-[10px] uppercase font-bold px-2 py-0.5 rounded-md bg-zinc-950 text-zinc-500 border border-zinc-800 group-hover:border-zinc-700 transition-colors">{{ note.category }}</span>
              {% endif %}
          </div>
          
          <div class="bg-zinc-950/80 rounded-md border border-zinc-800/80 p-3 mb-4 text-xs text-zinc-300 overflow-x-auto custom-scrollbar font-mono group-hover:border-zinc-700 transition-colors shadow-inner">
            <code>{{ note.command }}</code>
          </div>
          
          <div class="description text-sm text-zinc-400 mb-4 prose prose-sm prose-invert max-w-none line-clamp-3 leading-relaxed opacity-90">
            {{ note.description|safe }}
          </div>
          
          <!-- Spacer -->
          <div class="mt-auto"></div>

          {% if note.tags %}
          <div class="tags flex flex-wrap gap-2 mb-4 pt-2">
            {% for tag in note.tags.split(',') %}
            <span class="tag inline-flex items-center px-2 py-1 rounded bg-zinc-800/40 text-[10px] font-medium text-zinc-500 border border-zinc-800 hover:border-zinc-600 hover:text-zinc-300 cursor-pointer transition-colors" data-tag="{{ tag.strip() }}">
                #{{ tag.strip() }}
            </span>
            {% endfor %}
          </div>
          {% endif %}

          <div class="note-actions flex flex-wrap items-center justify-between pt-4 border-t border-zinc-800/50 gap-y-3">
            <div class="flex items-center gap-4">
                <button
                class="btn copy inline-flex items-center gap-1.5 text-xs font-medium text-zinc-500 hover:text-white transition-colors"
                onclick="copyToClipboard('{{ note.command }}', this)"
                >
                <span>üìã</span> Copy
                </button>
                
                <!-- Public Toggle -->
                <form action="{{ url_for('main.toggle_public', note_id=note.id) }}" method="POST" class="inline-flex">
                    <button type="submit" class="text-xs flex items-center gap-1.5 transition-colors {{ 'text-green-500 hover:text-green-400' if note.is_public else 'text-zinc-600 hover:text-zinc-400' }}" title="{{ 'Make Private' if note.is_public else 'Make Public' }}">
                        {{ 'üåé Public' if note.is_public else 'üîí Private' }}
                    </button>
                </form>

                {% if note.is_public and note.public_id %}
                <a href="{{ url_for('main.public_note', public_id=note.public_id) }}" target="_blank" class="text-xs text-blue-500 hover:text-blue-400 transition-colors flex items-center gap-1">
                    <span>View</span> ‚Üó
                </a>
                <button onclick="navigator.clipboard.writeText('{{ url_for('main.public_note', public_id=note.public_id, _external=True) }}'); alert('Public Link Copied!')" class="text-xs text-zinc-500 hover:text-white transition-colors" title="Copy Public Link">
                    üîó
                </button>
                {% endif %}
            </div>

            <div class="flex gap-3">
                <a href="/edit/{{ note.id }}" class="btn edit inline-flex items-center text-xs font-medium text-zinc-500 hover:text-zinc-300 transition-colors">Edit</a>
                <a
                  href="/delete/{{ note.id }}"
                  class="btn delete inline-flex items-center text-xs font-medium text-zinc-600 hover:text-red-400 transition-colors"
                  onclick="return confirm('Delete this note?')"
                >
                  Delete
                </a>
            </div>
          </div>
        </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state text-center py-20 bg-zinc-900/30 rounded-xl border border-dashed border-zinc-800">
    <div class="text-4xl mb-4 opacity-50">üìù</div>
    <h3 class="text-lg font-semibold text-zinc-300 mb-2">No notes yet</h3>
    <p class="text-zinc-500 mb-6">Create your first snippet in the terminal above.</p>
    <a href="#add-note-card" class="inline-flex items-center px-4 py-2 bg-accent-600 hover:bg-accent-700 text-white font-medium rounded transition-colors shadow-lg shadow-accent-900/20">Create Snippet</a>
  </div>
  {% endif %}
</section>

<style>
/* Custom Grid/List Styles for Vue Toggle Logic */
#notesGrid.list-view {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}
#notesGrid.list-view .feature-card {
    flex-direction: row;
    align-items: center;
    gap: 1.5rem;
}
#notesGrid.list-view .feature-card > .relative {
    display: flex;
    flex-direction: row;
    align-items: center;
    width: 100%;
    gap: 1.5rem;
}
#notesGrid.list-view .description {
    display: none; /* Hide description in list view for compactness */
    /* Or make it flex-1 */
}
#notesGrid.list-view .tags {
    margin-bottom: 0;
    margin-top: 0;
}
#notesGrid.list-view .note-actions {
    border-top: none;
    margin-top: 0;
    padding-top: 0;
    margin-left: auto;
}
</style>

{% endblock %}

{% block extra_js %}

<script src="{{ url_for('static', filename='js/editor.js') }}"></script>
<!-- Quill JS (Keep existing) -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
{% endblock %}
